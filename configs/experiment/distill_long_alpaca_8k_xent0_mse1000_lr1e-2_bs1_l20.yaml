dataset:
  name: alpaca_clean
  dataset_config:
    name: alpaca
    path: yahma/alpaca-cleaned
    chunk_size: 8192 # sequence length for distilling
    concat_data: true
    cache_dir: "data/alpaca" # Change this to where you want to save
    # system_prompt: "You are a helpful assistant who always responds to appropriately complete a user's request."
  pretrained_model_config: # will be updated based on model_config
    pretrained_model_name_or_path: "meta-llama/Meta-Llama-3-8B"
    cache_dir: "/scr-ssd/mzhang/models/llama3"
  preprocess_config: null

dataloader:
  batch_size: 1
  num_workers: 2
  drop_last: false
  pin_memory: true

optimizer:
  optim: adamw_torch_fused
  lr: 0.01
  weight_decay: 0.0

lr_scheduler:
  lr_scheduler_type: reduce_lr_on_plateau
  mode: min
  factor: 0.1
  patience: 10
  min_lr: 0.00001

trainer: # HuggingFace Trainer-like arguments
  name: distill_attention_xent_mse_chunked
  reverse_kl: false
  attn_xent_factor: 0
  mse_factor: 1000
  kd_factor: 0
  lm_factor: 0
  kd_temperature: 1

  bf16: true
  train_split: train
  val_split: validation
  num_train_epochs: 4
  gradient_accumulation_steps: 1
  seed: 42
  batch_size: 1
  load_best_model_at_end: true
  greater_is_better: false
  metric_for_best_model: eval/loss
  logging_steps: 20
  evaluation_strategy: steps
  max_steps: -1
  eval_steps: 20
  max_eval_batches: 20
